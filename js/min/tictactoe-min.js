$(function(){function t(){this.results=[],this.currentPlayer=0,this.initiateBoard=function(){for(var t=0;4>t;t++){this.results[t]=[];for(var s=0;4>s;s++){var r=4*t+s+1;this.results[t][s]=0;var e=$("div").find("[id="+r+"]");e.attr("col",s),e.attr("row",t)}}this.currentPlayer=1},this.updateCell=function(t,s){if(console.log("Updating cell"),0!==this.results[t][s])window.alert("The cell is occupied!");else{this.results[t][s]=this.currentPlayer,console.log("row: "+t+", "+s);var r=$("div").find("[row="+t+"][col="+s+"]");r.parent().addClass("opened flip"),console.log("Real player "+this.currentPlayer),1===this.currentPlayer?r.parent().addClass("opened-p1"):r.parent().addClass("opened-p2")}},this.drawMark=function(t){return 1===t?"X":"O"},this.turnsLeft=function(){for(var t=16,s=0;4>s;s++)for(var r=0;4>r;r++)0!==this.results[s][r]&&(t-=1);return t},this.endTurn=function(){1===this.currentPlayer?(console.log("changin"),this.currentPlayer=-1,$(".wrapper").removeClass("p1-turn"),$(".wrapper").addClass("p2-turn")):(this.currentPlayer=1,$(".wrapper").removeClass("p2-turn"),$(".wrapper").addClass("p1-turn"))},this.playGame=function(t,s){void 0===this.determineWinner()&&(this.updateCell(t,s),this.endTurn()),this.gameOver()},this.gameOver=function(){var t=this;void 0!==this.determineWinner()&&setTimeout(function(){window.alert("The winner is "+t.drawMark(t.determineWinner()))},100),0===this.turnsLeft()&&window.alert("Sorry, no more turns!")},this.determineWinner=function(){return void 0!==this.checkRows()?this.checkRows():void 0!==this.checkCols()?this.checkCols():void 0!==this.checkDiagonals()?this.checkDiagonals():void 0},this.checkRows=function(){for(var t=0;4>t;t++){var s=this.results[t][0]+this.results[t][1]+this.results[t][2]+this.results[t][3];if(4===s||-4===s)return this.results[t][0]}},this.checkCols=function(){for(var t=0;4>t;t++){var s=this.results[0][t]+this.results[1][t]+this.results[2][t]+this.results[3][t];if(4===s||-4===s)return this.results[0][t]}},this.checkDiagonals=function(){var t=this.results[0][0]+this.results[1][1]+this.results[2][2]+this.results[3][3];return 4===t||-4===t?this.results[1][1]:(t=this.results[0][3]+this.results[1][2]+this.results[2][1]+this.results[3][0],4===t||-4===t?this.results[1][1]:void 0)}}var s=new t;s.initiateBoard(),$(".box").click(function(){var t=$(this).children().attr("col"),r=$(this).children().attr("row");s.playGame(r,t)}),$("#button_wrapper").click(function(){location.reload()})});