$(function(){function Card(){this.cardName="",this.cardEffects=[],this.cardImage="",this.cardBody="",this.createCard=function(r){this.cardBody=jQuery("<div/>",{"class":"card drawn "+this.cardName.toLowerCase()}),jQuery("<div/>",{"class":"cardName",text:this.cardName}).appendTo(this.cardBody),jQuery("<div/>",{"class":"cardEffects",text:this.cardEffects.join()}).appendTo(this.cardBody),$(".p"+r+"-hand:first").append(this.cardBody)}}function Player(number){this.playerNo=number,this.deck=[],this.hand=[],this.active=[],this.discard=[],this.createDeck=function(){function shuffle(r){for(var e,t,s=r.length;s;e=Math.floor(Math.random()*s),t=r[--s],r[s]=r[e],r[e]=t);return r}for(var tempDeck=JSON.parse(eval("deck_p"+this.playerNo)),i=0;i<tempDeck.length;i++){var newCard=new Card;newCard.cardName=tempDeck[i];for(var j=0;j<cards.length;j++)cards[j].name===newCard.cardName&&(newCard.cardEffects=cards[j].effects);this.deck.push(newCard)}this.deck=shuffle(this.deck)},this.drawCard=function(){this.deck.length>0&&(this.deck[0].createCard(this.playerNo),window.console.log(this.deck[0]),this.hand.push(this.deck[0]),this.deck.splice(0,1),$(".hand").append())}}function Board(){this.results=[],this.currentPlayer=0,this.initiateBoard=function(){for(var r=0;4>r;r++){this.results[r]=[];for(var e=0;4>e;e++){var t=4*r+e+1;this.results[r][e]=0;var s=$("div").find("[id="+t+"]");s.attr("col",e),s.attr("row",r)}}this.currentPlayer=1},this.endTurn=function(){if(1===this.currentPlayer){window.console.log("changin"),this.currentPlayer=-1,$(".wrapper").removeClass("p1-turn"),$(".wrapper").addClass("p2-turn");for(var r=0;r<player1.hand.length;r++)player1.hand[r].cardBody.addClass("hidden");for(var r=0;r<player2.hand.length;r++)player2.hand[r].cardBody.removeClass("hidden")}else{this.currentPlayer=1,$(".wrapper").removeClass("p2-turn"),$(".wrapper").addClass("p1-turn");for(var r=0;r<player2.hand.length;r++)player2.hand[r].cardBody.addClass("hidden");for(var r=0;r<player1.hand.length;r++)player1.hand[r].cardBody.removeClass("hidden")}},this.updateCell=function(r,e){if(window.console.log("Updating cell"),0!==this.results[r][e])window.alert("The cell is occupied!");else{this.results[r][e]=this.currentPlayer,window.console.log("row: "+r+", "+e);var t=$("div").find("[row="+r+"][col="+e+"]");t.parent().addClass("opened flip"),window.console.log("Real player "+this.currentPlayer),1===this.currentPlayer?t.parent().addClass("opened-p1"):t.parent().addClass("opened-p2"),this.endTurn()}},this.drawMark=function(r){return 1===r?"X":"O"},this.turnsLeft=function(){for(var r=16,e=0;4>e;e++)for(var t=0;4>t;t++)0!==this.results[e][t]&&(r-=1);return r},this.playGame=function(r,e){void 0===this.determineWinner()&&this.updateCell(r,e),this.gameOver()},this.gameOver=function(){var r=this;void 0!==this.determineWinner()&&setTimeout(function(){window.alert("The winner is "+r.drawMark(r.determineWinner()))},100),0===this.turnsLeft()&&window.alert("Sorry, no more turns!")},this.determineWinner=function(){return void 0!==this.checkRows()?this.checkRows():void 0!==this.checkCols()?this.checkCols():void 0!==this.checkDiagonals()?this.checkDiagonals():void 0},this.checkRows=function(){for(var r=0;4>r;r++){var e=this.results[r][0]+this.results[r][1]+this.results[r][2]+this.results[r][3];if(4===e||-4===e)return this.results[r][0]}},this.checkCols=function(){for(var r=0;4>r;r++){var e=this.results[0][r]+this.results[1][r]+this.results[2][r]+this.results[3][r];if(4===e||-4===e)return this.results[0][r]}},this.checkDiagonals=function(){var r=this.results[0][0]+this.results[1][1]+this.results[2][2]+this.results[3][3];return 4===r||-4===r?this.results[1][1]:(r=this.results[0][3]+this.results[1][2]+this.results[2][1]+this.results[3][0],4===r||-4===r?this.results[1][1]:void 0)}}var startHandSize=3,maxHandSize=10;window.console.log(cards);var b=new Board;b.initiateBoard();var player1=new Player(1),player2=new Player(2);player1.createDeck(),player2.createDeck();for(var i=0;startHandSize>i;i++)player1.drawCard();for(var i=0;startHandSize>i;i++)player2.drawCard();$(".p1-hand").sortable(),$(".p2-hand").sortable(),$(".box").click(function(){var r=$(this).children().attr("col"),e=$(this).children().attr("row");b.playGame(e,r)}),$("#button_wrapper").click(function(){location.reload()})});