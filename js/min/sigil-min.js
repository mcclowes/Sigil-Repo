$(function(){function t(){this.deck=[],this.hand=[],this.discard=[],this.createDeck=function(t){$.getJSON("js/deck_p"+t+".json",function(t){var s=[];$.each(t,function(t,e){s.push("<li id='"+t+"'>"+e+"</li>")}),$("<ul/>",{"class":"card ",html:s.join("")}).appendTo("body")}),this.deck=items}}function s(){this.results=[],this.currentPlayer=0,this.initiateBoard=function(){for(var t=0;4>t;t++){this.results[t]=[];for(var s=0;4>s;s++){var e=4*t+s+1;this.results[t][s]=0;var r=$("div").find("[id="+e+"]");r.attr("col",s),r.attr("row",t)}}this.currentPlayer=1},this.endTurn=function(){1===this.currentPlayer?(window.console.log("changin"),this.currentPlayer=-1,$(".wrapper").removeClass("p1-turn"),$(".wrapper").addClass("p2-turn")):(this.currentPlayer=1,$(".wrapper").removeClass("p2-turn"),$(".wrapper").addClass("p1-turn"))},this.updateCell=function(t,s){if(window.console.log("Updating cell"),0!==this.results[t][s])window.alert("The cell is occupied!");else{this.results[t][s]=this.currentPlayer,window.console.log("row: "+t+", "+s);var e=$("div").find("[row="+t+"][col="+s+"]");e.parent().addClass("opened flip"),window.console.log("Real player "+this.currentPlayer),1===this.currentPlayer?e.parent().addClass("opened-p1"):e.parent().addClass("opened-p2"),this.endTurn()}},this.drawMark=function(t){return 1===t?"X":"O"},this.turnsLeft=function(){for(var t=16,s=0;4>s;s++)for(var e=0;4>e;e++)0!==this.results[s][e]&&(t-=1);return t},this.playGame=function(t,s){void 0===this.determineWinner()&&this.updateCell(t,s),this.gameOver()},this.gameOver=function(){var t=this;void 0!==this.determineWinner()&&setTimeout(function(){window.alert("The winner is "+t.drawMark(t.determineWinner()))},100),0===this.turnsLeft()&&window.alert("Sorry, no more turns!")},this.determineWinner=function(){return void 0!==this.checkRows()?this.checkRows():void 0!==this.checkCols()?this.checkCols():void 0!==this.checkDiagonals()?this.checkDiagonals():void 0},this.checkRows=function(){for(var t=0;4>t;t++){var s=this.results[t][0]+this.results[t][1]+this.results[t][2]+this.results[t][3];if(4===s||-4===s)return this.results[t][0]}},this.checkCols=function(){for(var t=0;4>t;t++){var s=this.results[0][t]+this.results[1][t]+this.results[2][t]+this.results[3][t];if(4===s||-4===s)return this.results[0][t]}},this.checkDiagonals=function(){var t=this.results[0][0]+this.results[1][1]+this.results[2][2]+this.results[3][3];return 4===t||-4===t?this.results[1][1]:(t=this.results[0][3]+this.results[1][2]+this.results[2][1]+this.results[3][0],4===t||-4===t?this.results[1][1]:void 0)}}var e=new s;e.initiateBoard();var r=new t,i=new t;r.createDeck(1),i.createDeck(2),$(".p1-hand").sortable(),$(".p2-hand").sortable(),$(".box").click(function(){var t=$(this).children().attr("col"),s=$(this).children().attr("row");e.playGame(s,t)}),$("#button_wrapper").click(function(){location.reload()})});